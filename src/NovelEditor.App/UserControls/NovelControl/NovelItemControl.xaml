<UserControl
    x:Class="NovelEditor.UserControls.NovelControl.NovelItemControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Width="200"
    Height="320"
    mc:Ignorable="d">

    <Grid x:Name="RootGrid" CornerRadius="8" ToolTipService.ToolTip="{x:Bind Novel.Description, Mode=OneWay}">
        <!-- 阴影效果 -->
        <Grid.Shadow>
            <ThemeShadow />
        </Grid.Shadow>

        <!-- 视觉状态管理器，用于处理悬停动画 -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="CommonStates">
                <VisualState x:Name="Normal" />
                <VisualState x:Name="PointerOver">
                    <Storyboard>
                        <!-- 放大动画 -->
                        <DoubleAnimation
                            Storyboard.TargetName="RootGrid"
                            Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                            To="1.03"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <DoubleAnimation
                            Storyboard.TargetName="RootGrid"
                            Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                            To="1.03"
                            Duration="0:0:0.2">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut" />
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <!-- 显示操作按钮 -->
                        <DoubleAnimation
                            Storyboard.TargetName="ActionsPanel"
                            Storyboard.TargetProperty="Opacity"
                            To="1"
                            Duration="0:0:0.2" />
                    </Storyboard>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <!-- 设置中心点和初始缩放，用于动画 -->
        <Grid.RenderTransform>
            <ScaleTransform CenterX="100" CenterY="160" />
        </Grid.RenderTransform>

        <!-- 封面图片 -->
        <Grid x:Name="CoverImageGrid" CornerRadius="8">
            <Grid.Background>
                <ImageBrush x:Name="CoverImageBrush" Stretch="UniformToFill" />
            </Grid.Background>
        </Grid>

        <!-- 无封面时的占位符 -->
        <Grid x:Name="PlaceholderGrid" Background="{ThemeResource SystemAccentColorLight2}" CornerRadius="8" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="8">
                <SymbolIcon Symbol="Page" Foreground="{ThemeResource SystemAccentColor}" />
                <TextBlock Text="暂无封面" HorizontalAlignment="Center" Foreground="{ThemeResource SystemAccentColor}" />
            </StackPanel>
        </Grid>

        <!-- 底部信息区域的渐变遮罩 -->
        <Border VerticalAlignment="Bottom" Height="120" CornerRadius="0,0,8,8">
            <Border.Background>
                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                    <GradientStop Color="Transparent" Offset="0" />
                    <GradientStop Color="#CC000000" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>
        </Border>

        <!-- 底部信息文本 -->
        <StackPanel VerticalAlignment="Bottom" Padding="12" Spacing="4">
            <TextBlock
                Text="{x:Bind Novel.NovelTitle, Mode=OneWay}"
                FontSize="18"
                FontWeight="SemiBold"
                Foreground="White"
                TextTrimming="CharacterEllipsis"
                MaxLines="2" />
            <TextBlock
                Text="{x:Bind Novel.Author, Mode=OneWay}"
                FontSize="12"
                Foreground="White"
                Opacity="0.8" />
            <TextBlock
                x:Name="UpdateDateTextBlock"
                FontSize="12"
                Foreground="White"
                Opacity="0.6" />
        </StackPanel>

        <!-- 悬停时显示的操作按钮面板 -->
        <StackPanel
            x:Name="ActionsPanel"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Margin="8"
            Opacity="0"
            Orientation="Horizontal"
            Spacing="4">
            <Button
                x:Name="ChangeCoverButton"
                Width="42"
                Height="42"
                Click="ChangeCoverButton_Click"
                ToolTipService.ToolTip="更换封面">
                <Button.Content>
                    <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}" 
                              Glyph="&#xE722;"
                              FontSize="16"/>
                </Button.Content>
            </Button>
            <Button
                x:Name="DeleteButton"
                Width="42"
                Height="42"
                ToolTipService.ToolTip ="删除小说">
                <Button.Resources>
                    <ResourceDictionary>
                        <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="DarkRed"/>
                    </ResourceDictionary>
                </Button.Resources>
                <Button.Content>
                    <FontIcon FontFamily="{ThemeResource SymbolThemeFontFamily}" 
                              Glyph="&#xE74D;"
                              FontSize="16"/>
                </Button.Content>
                <!-- 删除确认弹窗 -->
                <Button.Flyout>
                    <Flyout Placement="Bottom">
                        <StackPanel Spacing="8">
                            <TextBlock Text="确定要删除这本小说吗？" />
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Button
                                    x:Name="ConfirmDeleteButton"
                                    Grid.Column="0"
                                    Margin="0,0,4,0"
                                    HorizontalAlignment="Stretch"
                                    Click="ConfirmDeleteButton_Click"
                                    Content="确定"/>
                                <Button
                                    Grid.Column="1"
                                    Margin="4,0,0,0"
                                    HorizontalAlignment="Stretch"
                                    Click="CancelDeleteButton_Click"
                                    Content="取消" />
                            </Grid>
                        </StackPanel>
                    </Flyout>
                </Button.Flyout>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
